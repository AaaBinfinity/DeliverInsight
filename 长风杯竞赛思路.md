---
--25.10.2，by Binfinity
---

# 长风杯思路整理

[TOC]



## 一、赛题：企业客户群识别

### 1.1 赛题描述

**企业客户群识别：**某大型快运企业服务覆盖全国300多个城市，主要客户为第三方电商卖家。近年来因客户管理粗放，高价值客户流失严重，投诉率持续攀升。企业亟需基于客户历史运单、业务量等数据，运用K-means算法识别不同价值层级的客户群体，精准刻画客户特征，为实施差异化服务策略和精细化营销提供数据支持，提升客户满意度与忠诚度。

### 1.2 具体任务

①整合客户历史运单与业务量数据，形成客户行为分析数据集；
②应用聚类算法（如K-means）对客户进行分群，识别高价值、潜力、常规等客户群体；
③分析各客户群特征，制定差异化服务策略与精准营销方案。

### 1.3 数据描述

- 使用蓝鲸数据挖掘工具的参赛人员可从蓝鲸【数据】组件点击【更多数据】获取竞赛数据；
- 使用Python（可使用本地Python工具）或其他工具的参赛人员可以从以下链接获取数据：
  链接: https://pan.baidu.com/s/1MMwB6bBaQytJVD7LB-M0Ug?pwd=5fy8 提取码: 5fy8

#### 数据格式

##### 快运企业数据集:

四个表,`sqlite_master.csv`如下:

```csv
type,name,tbl_name,rootpage,sql
table,Customer,Customer,2,"CREATE TABLE ""Customer"" (
  ""客户账号"" integer(32),
  ""运单数"" integer(32),
  ""业务量"" real(53),
  ""体积"" real(53),
  ""计费重量"" real(53),
  ""重泡标识"" text(255),
  ""主要始发站"" text(255),
  ""主要终点站"" text(255),
  ""开始城市"" text(255),
  ""终点城市"" text(255),
  ""服务类型"" text(255),
  ""结算方式"" text(255),
  ""收益站"" text(255),
  ""收益"" real(53),
  ""近期合作月份_time"" text,
  ""近期合作日期_time"" text,
  ""创收站"" text(255),
  ""流失情况"" text(255)
)"
table,bwds_meta,bwds_meta,1590,"CREATE TABLE ""bwds_meta"" (
  ""ID"" INT NOT NULL,
  ""Name"" VARCHAR(50) NOT NULL,
  ""Table_name"" VARCHAR(50) NOT NULL,
  ""Type"" VARCHAR(10) NOT NULL,
  ""Alias"" VARCHAR(100),
  ""Intro"" VARCHAR(255),
  PRIMARY KEY (""ID"")
)"
index,sqlite_autoindex_bwds_meta_1,bwds_meta,1591,
table,order,order,1592,"CREATE TABLE ""order"" (
  ""运单号"" TEXT(255),
  ""件数"" TEXT(255),
  ""毛重"" TEXT(255),
  ""体积"" TEXT(255),
  ""计费重量"" TEXT(255),
  ""重泡标识"" TEXT(255),
  ""始发站"" TEXT(255),
  ""目的站"" TEXT(255),
  ""始发城市"" TEXT(255),
  ""目的城市"" TEXT(255),
  ""运输类型"" TEXT(255),
  ""运单类型"" TEXT(255),
  ""结算方式"" TEXT(255),
  ""客户账号"" TEXT(255),
  ""客户名称"" TEXT(255),
  ""收入站"" TEXT(255),
  ""收入金额"" TEXT(255),
  ""收入月份_time"" TEXT(255),
  ""录入站点"" TEXT(255),
  ""f22"" TEXT(255),
  ""superiorinstitution"" TEXT(255),
  ""optype"" TEXT(255),
  ""superiorarea"" TEXT(255),
  ""lat"" TEXT(255),
  ""lng"" TEXT(255),
  ""录入时间_time"" TEXT(255),
  ""录入日期_time"" TEXT(255),
  ""签字日期_time"" TEXT(255)
)"

```

字段说明表`bwds_meta.csv`:

| Name                | Table_name | Type | Alias            |
| ------------------- | ---------- | ---- | ---------------- |
| Customer            | Customer   | TAB  | 快运企业客户数据 |
| 客户账号            | Customer   | COL  | 客户账号         |
| 运单数              | Customer   | COL  | 运单数           |
| 业务量              | Customer   | COL  | 业务量           |
| 体积                | Customer   | COL  | 体积             |
| 计费重量            | Customer   | COL  | 计费重量         |
| 重泡标识            | Customer   | COL  | 重泡标识         |
| 主要始发站          | Customer   | COL  | 主要始发站       |
| 主要终点站          | Customer   | COL  | 主要终点站       |
| 开始城市            | Customer   | COL  | 开始城市         |
| 终点城市            | Customer   | COL  | 终点城市         |
| 服务类型            | Customer   | COL  | 服务类型         |
| 结算方式            | Customer   | COL  | 结算方式         |
| 收益站              | Customer   | COL  | 收益站           |
| 收益                | Customer   | COL  | 收益             |
| 近期合作月份_time   | Customer   | COL  | 近期合作月份     |
| 近期合作日期_time   | Customer   | COL  | 近期合作日期     |
| 创收站              | Customer   | COL  | 创收站           |
| 流失情况            | Customer   | COL  | 流失情况         |
| order               | order      | TAB  | 运单表           |
| 运单号              | order      | COL  | 运单号           |
| 件数                | order      | COL  | 件数             |
| 毛重                | order      | COL  | 毛重             |
| 体积                | order      | COL  | 体积             |
| 计费重量            | order      | COL  | 计费重量         |
| 重泡标识            | order      | COL  | 重泡标识         |
| 始发站              | order      | COL  | 始发站           |
| 目的站              | order      | COL  | 目的站           |
| 始发城市            | order      | COL  | 始发城市         |
| 目的城市            | order      | COL  | 目的城市         |
| 运输类型            | order      | COL  | 运输类型         |
| 运单类型            | order      | COL  | 运单类型         |
| 结算方式            | order      | COL  | 结算方式         |
| 客户账号            | order      | COL  | 客户账号         |
| 客户名称            | order      | COL  | 客户名称         |
| 收入站              | order      | COL  | 收入站           |
| 收入金额            | order      | COL  | 收入金额         |
| 收入月份_time       | order      | COL  | 收入月份         |
| 录入站点            | order      | COL  | 录入站点         |
| superiorinstitution | order      | COL  | 机构             |
| optype              | order      | COL  | 站点状态         |
| superiorarea        | order      | COL  | 区域             |
| lat                 | order      | COL  | 纬度             |
| lng                 | order      | COL  | 经度             |
| 录入时间_time       | order      | COL  | 录入时间         |
| 录入日期_time       | order      | COL  | 录入日期         |
| 签字日期_time       | order      | COL  | 签字日期         |

`Customer`表,快运企业客户数据,该表记录了客户的付款信息，包括客户信息、运输的费用信息等。示例数据如下

```csv
客户账号,运单数,业务量,体积,计费重量,重泡标识,主要始发站,主要终点站,开始城市,终点城市,服务类型,结算方式,收益站,收益,近期合作月份_time,近期合作日期_time,创收站,流失情况
1,344,6880,27.52,6880,重货,上海站,长沙站,上海,长沙,标快服务,月结,上海大客户站,3199.2,2015-10-01,2015-10-15,上海站,未流失
2,420,8400,33.6,8400,重货,上海站,郑州站,上海,郑州,标快服务,月结,上海大客户站,3738,2015-10-01,2015-10-09,上海站,未流失
3,65,1300,5.2,1300,重货,上海站,长沙站,上海,长沙,标快服务,月结,上海大客户站,604.5,2015-10-01,2015-10-12,上海站,未流失
4,489,9780,39.12,9780,重货,上海站,南京站,上海,南京,标快服务,月结,上海大客户站,2934,2015-10-01,2015-10-09,上海站,未流失
5,107,2140,8.56,2140,重货,上海站,唐山站,上海,唐山,标快服务,月结,上海大客户站,1177,2015-10-01,2015-11-03,上海大客户站,未流失
6,155,3100,12.4,3100,重货,上海站,郑州站,上海,郑州,标快服务,月结,上海大客户站,1379.5,2015-10-01,2015-10-09,上海站,未流失
```

`order`表,运单表,运单表记录了客户快运货物的详细信息，包括货物的件数，重量，体积以及下单时间等。示例数据如下

```csv
运单号,件数,毛重,体积,计费重量,重泡标识,始发站,目的站,始发城市,目的城市,运输类型,运单类型,结算方式,客户账号,客户名称,收入站,收入金额,收入月份_time,录入站点,f22,superiorinstitution,optype,superiorarea,lat,lng,录入时间_time,录入日期_time,签字日期_time
6135103344,1,180,0.5,180,重货,苏州站,南京站,苏州,苏州工业园区,零担,优先服务,现结,X05120106,新区站-苏州新区站 高传丽,新区站,258,1/4/2015,新区站,,苏州分公司,操作站点,华中区       ,31.2994,120.62,27/4/2015 09:41:00,24/4/2019 15:24:40,2015/4/28 22:00
6133126822,2,33,0.1,33,重货,北京站,济南站,北京,顺义区、天竺镇,零担,超区服务,月结,G00100101,天竺站-易兰德(北京)印务有限公司,天竺站,120,1/4/2015,北京站,,北京分公司,操作站点,华北区       ,39.905,116.405,26/4/2015 13:02:00,24/4/2019 15:24:40,2015/5/1 0:00
6130083876,11,416,2.93,732.5,泡货,广州站,重庆站,广州,白云区,零担,优先服务,月结,G00200157,中大站-广州逸臻服饰有限公司,中大站,1652,1/4/2015,广州站,,广州分公司,操作站点,华南区       ,23.1252,113.281,13/1/2021 18:27:03,24/4/2019 15:24:40,2015/4/10 22:00
6135732161,1,5000,1,5000,重货,惠州站,惠州站,惠州,惠阳城区,整车,超区服务,月结,G07520049,惠州站-荣丰供应链股份有限公司,惠州站,365,1/4/2015,惠州站,,深圳分公司,操作站点,华南区       ,23.0794,114.413,18/4/2015 10:30:00,24/4/2019 15:24:40,2015/5/15 0:00
6133810421,1,29.9,0.17,42.5,泡货,上海站,西安站,上海,宝山区,零担,标快服务,月结,G00210573,金桥站-上海堡尼 实业发展有限公司,金桥站,115,1/4/2015,上海站,,上海分公司,操作站点,华中区       ,31.2317,121.473,29/4/2015 17:01:00,24/4/2019 15:24:40,2015/5/5 22:00
```

## 二、文献整理

- [1] [基于多标签和改进K-means的综合能源客户分类与服务设计](https://kns.cnki.net/kcms2/article/abstract?v=3-fZNjprSaw5MCD2Mg3YNvb1JeSZZ-AQPMhq9lzdQVP6AxbVloIV9NNF26m6qNiG2vtoTuMi78dvrAI0O7CR318TndK0e7JY3yVhMRZquw5q6-OoqajQlp-gRaZ0Eqw74OL5OxzalYBt65rObeKp8g==&uniplatform=NZKPT&language=CHS). 王强;岳付昌;徐芳;顾阳;顾佳琪.[电工技术](https://navi.cnki.net/knavi/journals/DGJY/detail?uniplatform=NZKPT),[2025(16)](https://navi.cnki.net/knavi/journals/DGJY/issues/3-fZNjprSaw5MCD2Mg3YNjLGpQAKwRDlPdMF3LdPiWFVfsyBbKyKABVE7mVQzvpx?uniplatform=NZKPT)

  引入Calinski Harabasz(CH)聚类质量评价指标,将最高的CH得分所 对应的类设定为本研究的聚类数目。

## 三、实现思路

### 3.1 数据清洗与存储（cleandata）

为方便操作，整理并存储到服务器MySQL数据库中。

#### 3.1.1 格式转换

#### 3.1.2 处理缺失值

#### 3.1.3 上传到数据库

### 3.2 原始数据可视化（raw_data_viz）

### 3.3 数据聚类

#### 3.3.1 CH 指标优化 K-means 算法实现步骤

##### （1）输入

- 数据集  
  $$
  x = \{X_1, X_2, \dots, X_N\}
  $$
  其中 \(N\) 表示数据点的数量。

##### （2）确定最佳聚类数目 \(K\)

1. **计算 WGSS**  
   WGSS（Within-Groups Sum of Squared Error）为簇内平方误差和，用来度量簇内样本的紧密度。  
   WGSS 越小，则簇内越紧密，聚类效果越好。  
   计算公式：
   $$
   WGSS = \sum_{j=1}^{k} \sum_{m_i \in X_j} d(m_i, z_j)
   $$
   其中：  

   - \(z_j\) 为簇 \(X_j\) 的均值  
   - \(k\) 为假定的聚类簇数  
   - \(m_i\) 为 \(X_j\) 簇内的每个样本

2. **计算 BGSS**  
   BGSS（Between-Groups Sum of Squared Error）为簇间平方误差和，用来度量簇间样本的分离度。  
   BGSS 越大，则簇间越分散，聚类效果越好。  
   计算公式：
   $$
   BGSS = \sum_{j=1}^{k} n_j \, d(z_j, z)
   $$
   其中：  

   - \(z\) 为整个数据集的均值  
   - \(n_j\) 为簇 \(X_j\) 中包含的对象个数

3. **计算 CH 值**  
   CH 得分值 \(S\) 的计算公式：
   $$
   S(k) = \frac{WGSS}{BGSS} \times \frac{k-1}{n-k}
   $$
   WGSS 越小、BGSS 越大，则 CH 指标值越大，聚类效果越好。

4. **绘制 CH 折线图**  
   通过折线图确定最佳聚类数目 \(K\)。

##### （3）运行 K-means，得出聚类结果

1. **初始化聚类中心**  
   - 输入聚类数目 \(K\)，从数据集中随机选取 \(K\) 个点作为初始聚类中心 \(C_i\)（\(1 \le i \le K\)）。

2. **分配样本**  
   - 计算每个数据点与聚类中心 \(C_i\) 的欧氏距离，找出最短距离，将样本分配到对应的聚类中心。

3. **更新聚类中心**  
   - 计算每簇中所有点的平均值及平方误差，将平均值作为新的聚类中心，重复“分配样本”步骤。

4. **循环终止**  
   - 直至聚类中心不再变化或达到最大迭代次数，得到最终聚类结果。

##### （4）输出

- 聚类结果：

$$
C = \{C_1, C_2, \dots, C_k\}
$$

### 3.4 数学建模

### 3.5 机器学习整合模型

### 3.6 验证模型

### 3.7 撰写报告

